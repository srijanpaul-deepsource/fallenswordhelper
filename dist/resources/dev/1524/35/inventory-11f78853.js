import{$ as t,u as e,v as n,E as i,H as s,c as a,R as r,t as d,a6 as c,bc as o,bo as l,e as u,a5 as f,q as p,I as h,bp as m,h as b,p as y,aQ as v,ao as g,B as k,y as _,aq as x,a as I,aj as R,ak as L}from"./calfSystem-186455ab.js"
import{a as M}from"./allthen-e8de2991.js"
import{g as E}from"./guild-7919b015.js"
import{i as j}from"./indexAjaxJson-d4ea205b.js"
import{i as S,q as T,a as D}from"./queue-fa1cf464.js"
import{g as N}from"./takeItem-1446e931.js"
import{d as w}from"./daLoadInventory-1b2be31c.js"
import{g as A}from"./getInventory-f4bd7c93.js"
import{c as q}from"./createTable-4ac162e1.js"
import{i as G}from"./isSelected-8b20baae.js"
import{a as P,e as C,u as U}from"./useItem-93fd109f.js"
import{d as O}from"./daAjaxSendItemsToRecipient-8758e84b.js"
import{s as W,g as B}from"./idb-97f66b86.js"
import{c as F}from"./changeMinMax-51d14a10.js"
import{d as V}from"./dialog-bd85dd64.js"
import{m as H}from"./moveItem-649b9295.js"
import{h as Q}from"./htmlResult-6abf2074.js"
import{e as Y}from"./errorDialog-f7744f6f.js"
import{e as z}from"./executeAll-19d23fbc.js"
import{g as J}from"./getMembrList-c6679e1f.js"
import{l as X}from"./loadDataTables-0667a93b.js"
import{n as K}from"./notLastUpdate-03352984.js"
import{i as Z}from"./intValue-1ce02c09.js"
import{l as tt,p as et}from"./lvlTests-b430a512.js"
import"./all-3be74659.js"
import"./backpack-b90c384c.js"
import"./guildStore-1a4b81e0.js"
import"./cmdExport-c033d991.js"
import"./daUseItem-efd2f584.js"
import"./sendItems-baff06e8.js"
import"./numberIsNaN-1e8b4508.js"
import"./dialogMsg-eb4e9d8f.js"
import"./currentGuildId-7dd95943.js"
function nt(){return E({subcmd:"fetchinv"})}function it(t){const e={a:Number(t.a),b:Number(t.b),l:Number(t.l),n:t.extra?t.extra.name:t.n,t:Number(t.t)}
return{...t,...e}}function st(t){return{r:t.map(it),s:!0}}function at(){return j({cmd:"guild",subcmd:"fetchinv"}).then(st)}function rt(t){if(!t.children[0].href)return{a:-1,n:"-1",t:-1}
const e=Number(S(t.children[0].href)),n=s(t.previousElementSibling),i={a:e}
return n.endsWith(" (Potion)")?(i.n=n.slice(0,-9),i.t=15):(i.n=n,i.t=-1),i}function dt(t){const e=n(t)
return{r:i("#pCC table table td:nth-of-type(3n)",e).map(rt),s:!0}}function ct(){return e({cmd:"guild",subcmd:"inventory",subcmd2:"report"}).then(dt)}function ot(){return N({subcmd2:"report"})}let lt,ut=[]
function ft(t){lt=t}const pt=t=>15===t.t
function ht(t){r(t.r)&&(ut=Array.prototype.concat.apply([],t.r.map((t=>t.items))).filter(pt))}function mt(t){r(t.r)&&(ut=ut.concat(t.r.filter(pt)))}function bt(){return t(nt,at).then(mt)}function yt(){return t(ot,ct).then(mt)}function vt(t,e){return e.a===t}function gt(t){if(15===t.type){const e=ut.find(d(vt,t.inv_id))
e&&(t.item_name=e.n)}}function kt(){lt.items.forEach(gt)}function _t(){const t=[A().then(ft)]
return"invmanagernew"===a.subcmd&&t.push(w().then(ht)),"guildinvmgr"===a.subcmd&&(t.push(bt()),t.push(yt())),M(t,kt)}function $t(t,e){e.val(""),$(t).DataTable().search("").draw()}function xt(){lt.folders&&(lt.folders[-1]="Main")}const It={checkedElements:{0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,100:1,101:1,102:1,103:1,104:1,105:1,106:1},fshMinLvl:1,fshMaxLvl:9999},Rt='<table class="fshInvFilter"><tr><th colspan="14">@@reportTitle@@</th><th><span id="fshRefresh" class="fshLink">[Refresh]</span></th></tr><tr><td colspan="2" rowspan="3"><b>&nbsp;Show Items:</b></td><td class="fshRight">&nbsp;Helmet:</td><td><input id="fshHelmet" type="checkbox" item="0"/></td><td class="fshRight">&nbsp;Armor:</td><td><input id="fshArmor" type="checkbox" item="1"/></td><td class="fshRight">&nbsp;Gloves:</td><td><input id="fshGloves" type="checkbox" item="2"/></td><td class="fshRight">&nbsp;Boots:</td><td><input id="fshBoots" type="checkbox" item="3"/></td><td class="fshRight">&nbsp;Weapon:</td><td><input id="fshWeapon" type="checkbox" item="4"/></td><td></td><td class="fshRight">&nbsp;Min lvl:</td><td><input id="fshMinLvl" size="5" value="1"/></td></tr><tr><td class="fshRight">&nbsp;Shield:</td><td><input id="fshShield" type="checkbox" item="5"/></td><td class="fshRight">&nbsp;Ring:</td><td><input id="fshRing" type="checkbox" item="6"/></td><td class="fshRight">&nbsp;Amulet:</td><td><input id="fshAmulet" type="checkbox" item="7"/></td><td class="fshRight">&nbsp;Rune:</td><td><input id="fshRune" type="checkbox" item="8"/></td><td class="fshRight">&nbsp;Sets Only:</td><td><input id="fshSets" item="-1" type="checkbox"/></td><td></td><td class="fshRight">&nbsp;Max lvl:</td><td><input id="fshMaxLvl" size="5" value="9999"/></td></tr><tr><td colspan="2">&nbsp;[<span id="fshAll" class="fshLink">Select All</span>]</td><td colspan="2">&nbsp;[<span id="fshNone" class="fshLink">Select None</span>]</td><td colspan="2">&nbsp;[<span id="fshDefault" class="fshLink">Defaults</span>]</td><td colspan="6"></td><td><input id="fshReset" type="button" value="Reset"/></td></tr><tr><td class="fshRight">&nbsp;Quest Item:</td><td><input id="fshQuest" item="9" type="checkbox"/></td><td class="fshRight">&nbsp;Potion:</td><td><input id="fshPotion" item="10" type="checkbox"/></td><td class="fshRight">&nbsp;Resource:</td><td><input id="fshResource" item="12" type="checkbox"/></td><td class="fshRight">&nbsp;Recipe:</td><td><input id="fshRecipe" item="13" type="checkbox"/></td><td class="fshRight">&nbsp;Container:</td><td><input id="fshContainer" item="14" type="checkbox"/></td><td class="fshRight">&nbsp;Frag Stash:</td><td><input id="fshStash" item="16" type="checkbox"/></td><td class="fshRight">&nbsp;Composed:</td><td><input id="fshComposed" item="15" type="checkbox"/></td><td></td></tr><tr><td class="fshRight">&nbsp;Common:</td><td><input id="fshCommon" item="100" type="checkbox" checked/></td><td class="fshRight">&nbsp;Rare:</td><td><input id="fshRare" item="101" type="checkbox" checked/></td><td class="fshRight">&nbsp;Unique:</td><td><input id="fshUnique" item="102" type="checkbox" checked/></td><td class="fshRight">&nbsp;Legendary:</td><td><input id="fshLegendary" item="103" type="checkbox" checked/></td><td class="fshRight">&nbsp;Super Elite:</td><td><input id="fshSuperElite" item="104" type="checkbox" checked/></td><td class="fshRight">&nbsp;Crystalline:</td><td><input id="fshCrystalline" item="105" type="checkbox" checked/></td><td class="fshRight">&nbsp;Epic:</td><td colspan="2"><input id="fshEpic" item="106" type="checkbox" checked/></td></tr></table>',Lt={0:1,1:1,2:1,3:1,4:1,5:1,6:1,7:1,8:1,9:1,10:1,11:1,12:1,13:1,14:1,15:1,16:1,100:1,101:1,102:1,103:1,104:1,105:1,106:1},Mt={Perfect:{abbr:"Perf",colour:"#00b600",index:8},Excellent:{abbr:"Exc",colour:"#f6ed00",index:7},"Very Good":{abbr:"VG",colour:"#f67a00",index:6},Good:{abbr:"Good",colour:"#f65d00",index:5},Average:{abbr:"Ave",colour:"#f64500",index:4},Poor:{abbr:"Poor",colour:"#f61d00",index:3},"Very Poor":{abbr:"VPr",colour:"#b21500",index:2},Uncrafted:{abbr:"Unc",colour:"#666666",index:1}}
function Et(t){return Mt[t]?Mt[t].abbr:""}function jt(t,e){const n=function(t){return t.folder_id?function(t){return t.equipped?"fshGreen":"fshNavy"}(t):function(t){return-1===t.player_id?"fshNavy":"fshMaroon"}(t)}(e)
t.classList.add(n)}function St(t){return function(t){return t.player_id&&-1!==t.player_id}(t)||function(t){return t.folder_id&&-1!==t.guild_tag}(t)}function Tt(t){return`<span class="fshLink recallItem" invid="${t.inv_id}" playerid="${c(t.player_id,lt.player_id)}" mode="1" action="recall">GS</span>`}function Dt(t){return`<span class="fshLink storeItem" invid="${t.inv_id}">GS</span>`}function Nt(t,e,n){return"display"===t?n(e):"GS"}function wt(t,e){const n=function(t){return-1===t.player_id?4:St(t)?7:1}(e),i=function(t,e,n){return t||(-1!==e?e:n)}(lt.player_id,e.player_id,lt.guild_id)
let s=t
e.equipped&&(s=`<b>${t}</b>`)
let a=""
return function(t){return t.stats&&""!==t.stats.set_name}(e)&&(a=` (<span class="fshLink setName" set="${e.stats.set_name}">set</span>)`),`<a href="${o}${t}" class="fshInvItem tip-dynamic ${l[e.rarity].clas}" data-tipped="fetchitem.php?item_id=${e.item_id}&inv_id=${e.inv_id}&t=${n}&p=${i}">${s}</a>${a}`}const At=[[t=>t.player_id&&-1===t.player_id,(t,e)=>`takeItem" action="${e.a}`],[t=>t.player_id&&t.player_id!==lt.current_player_id,(t,e)=>`recallItem" playerid="${t.player_id}" mode="0" action="${e.a}`],[t=>function(t){return t.folder_id&&!t.equipped}(t)||function(t){return t.player_id&&!t.equipped&&t.player_id===lt.current_player_id}(t),(t,e)=>e.c]]
function qt(t,e){const n=At.find((e=>e[0](t)))
return n?`<span class="fshLink ${n[1](t,e)}" invid="${t.inv_id}">${e.b}</span>`:""}function Gt(t){return c(t.folder_id,t.player_id)}function Pt(t){return a.membrList[t]?a.membrList[t].username:"???"}function Ct(t,e){return t[0]-e[0]}function Ut(t,e){return`<option value="${e[0]}"${G(Number(e[0]),t)}>${e[1]}</option>`}let Ot,Wt,Bt
function Ft(t){Ot=p({},It),p(Ot,c(t,{})),Wt=h("showQuickDropLinks"),Bt=h("showQuickSendLinks")}const Vt=[{title:"Name",data:"item_name",render:function(t,e,n){return"display"!==e?t:wt(t,n)}},{title:"Level",data:"stats.min_level"},{title:"Where",data:Gt,render:{_:function(t,e,n){return n.folder_id?function(t){return t.equipped?-2:t.folder_id}(n):-1===n.player_id?"~":Pt(n.player_id)},display:function(t,e,n){return n.player_id?function(t){return-1===t.player_id?"Guild Store":`<a class="fshMaroon" href="${f}${t.player_id}">${Pt(t.player_id)}</a>`}(n):n.equipped?"Worn":`<select class="fshMoveItem" data-inv="${n.inv_id}">${i=n.folder_id,s=lt.folders,u(s).sort(Ct).map(d(Ut,i)).join("")}</select>`
var i,s},filter:function(t,e,n){return n.player_id?function(t){return-1===t.player_id?"Guild Store":Pt(t.player_id)}(n):n.equipped?"Worn":lt.folders[n.folder_id]}}},{title:"Type",data:"type",render:t=>m[t]},{title:"Att",data:"stats.attack"},{title:"Def",data:"stats.defense"},{title:"Arm",data:"stats.armor"},{title:"Dam",data:"stats.damage"},{title:"HP",data:"stats.hp"},{title:"Frg",data:"forge",render:function(t,e,n){if(n.type<9)return n.forge}},{title:"Craft",data:"craft",render:{_:t=>Mt[t]?Mt[t].index:0,display:Et,filter:Et}},{title:"Du%",data:"durability",render:function(t,e,n){if(n.type<9&&n.max_durability>0)return Math.ceil(n.durability/n.max_durability*100)}},{title:"BP",data:Gt,render:function(t,e,n){if(!n.folder_id&&n.player_id!==lt.current_player_id)return function(t,e){return"display"!==t?"BP":-1===e.player_id?`<span class="fshLink takeItem" invid="${e.inv_id}" action="take">BP</span>`:`<span class="fshLink recallItem" invid="${e.inv_id}" playerid="${e.player_id}" mode="0" action="recall">BP</span>`}(e,n)}},{title:"GS",data:Gt,render:function(t,e,n){return St(n)?Nt(e,n,Tt):function(t){return t.folder_id&&!t.bound}(n)?Nt(e,n,Dt):void 0}},{title:"W/U",data:"type",render:function(t,e,n){const i=[1,1,1,1,1,1,1,1,1,,2,2,,,,2][t]
return 1===i?qt(n,{a:"wear",b:"Wear",c:"wearItem"}):2===i?qt(n,{a:"use",b:"Use",c:"useItem"}):void 0}},{title:"setName",data:"stats.set_name",orderable:!1,visible:!1},{title:"Tag",data:"guild_tag",render:t=>-1===t?"No":"Yes"},{title:"Drop",data:"type",render:function(t,e,n){if(!function(t){return-1!==t.guild_tag||t.equipped}(n))return"display"!==e?"Drop":`<span class="dropItem tip-static dropLink" data-tipped="INSTANTLY DESTROY THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk." data-inv="${n.inv_id}">Drop</span>`}},{title:"Send",data:"type",render:function(t,e,n){if(!function(t){return t.equipped||-1===t.guild_tag&&t.bound}(n))return"display"!==e?"Send":`<span class="sendItem tip-static sendLink" data-tipped="INSTANTLY SEND THE ITEM. NO REFUNDS OR DO-OVERS! Use at own risk." data-inv="${n.inv_id}">Send</span>`}}]
function Ht(){return"player_id"in lt}function Qt(){const t=function(){const t=q({className:"hover fshXSmall",id:Ht()?"fshUserInv":"fshGuildInv"})
return b(y,t),t}()
return function(t){t.column(12).visible("current_player_id"in lt),t.column(17).visible(Ht()&&Wt),t.column(18).visible(Ht()&&Bt)}(function(t){return $(t).DataTable({autoWidth:!1,columnDefs:[{targets:"_all",defaultContent:""},{targets:[1,4,5,6,7,8,9,10,12,13],orderSequence:["desc","asc"]}],columns:Vt,createdRow:jt,data:lt.items,deferRender:!0,lengthMenu:[[50,100,150,200,-1],[50,100,150,200,"All"]],pageLength:50,stateDuration:0,stateSave:!0})}(t)),t}function Yt(t){return O(t).then(P)}function zt(t){W(`fsh_${a.subcmd}`,t)}function Jt(){i('table.fshInvFilter input[type="checkbox"]').forEach((t=>{t.checked=1===Ot.checkedElements[t.getAttribute("item")]})),zt(Ot)}function Xt(t){Ot.checkedElements=Lt,Jt(),$(t).DataTable().draw(!1)}function Kt(t,e){Ot.fshMinLvl=t,Ot.fshMaxLvl=e,zt(Ot)}function Zt(t){$(t).DataTable().draw(!1)}function te(t){F(Kt,d(Zt,t))}function ee(t){return Number(t[0])>=100}function ne(t,e){return t[e[0]]=e[1],t}function ie(t){var e
Ot.checkedElements=(e=Ot.checkedElements,u(e).filter(ee).reduce(ne,{})),Jt(),$(t).DataTable().draw()}function se(t,e){t.eq(e).empty()}function ae(t,e){if(1===e.r)return
const n=t.closest("tr")
!function(t){[2,12,13,14,15,16].forEach(d(se,t))}($("td",n)),n.css("text-decoration","line-through")}function re(t,e){v(e),function(t){t.closest("tr").find(".takeItem, .recallItem, .wearItem, .dropItem, .sendItem, .storeItem").removeClass()}(e),t().then(d(ae,e)),function(t){t.empty().append(`<img src="${g}ui/misc/spinner.gif" width="11" height="11">`)}(e)}function de(t){return j({cmd:"profile",subcmd:"dodropitems",removeIndex:t,ajax:1}).then(V)}function ce(t){Ot.checkedElements={},i('table.fshInvFilter input[type="checkbox"][item]:checked').forEach((t=>{Ot.checkedElements[t.getAttribute("item")]=1})),zt(Ot),$(t).DataTable().draw(!1)}function oe(t){Ot.checkedElements=It.checkedElements,Jt(),$(t).DataTable().draw(!1)}function le(t){Ot.fshMinLvl=It.fshMinLvl,Ot.fshMaxLvl=It.fshMaxLvl,zt(Ot),$("#fshMinLvl").val(Ot.fshMinLvl),$("#fshMaxLvl").val(Ot.fshMaxLvl),$(t).DataTable().draw(!1)}function ue(t){return N({subcmd2:"dostoreitems",storeIndex:t})}function fe(t){return e({cmd:"guild",subcmd:"inventory",subcmd2:"dostoreitems",storeIndex:t}).then(Q)}function pe(e){return function(e){return t(ue,fe,e)}(e).then(Y).then(P)}function he(t,e){$(t).DataTable().search($(e.target).attr("set")).draw(),$(`#${t.id}_filter input`).trigger("focus")}function me(t){const e=$(t.target)
re(d(T,e.attr("invid"),e.attr("action")),e)}function be(t){const e=$(t.target)
re(d(D,e.attr("invid"),e.attr("playerid"),e.attr("mode"),e.attr("action")),e)}function ye(t){const e=$(t.target)
re(d(C,e.attr("invid")),e)}function ve(t){const e=$(t.target)
re(d(U,e.attr("invid")),e)}function ge(t){const e=$(t.target)
H([e.data("inv")],e.val())}function ke(t){const e=$(t.target)
re(d(pe,[e.attr("invid")]),e)}function _e(t){const e=$(t.target)
re(d(de,[e.data("inv")]),e)}function $e(t){const e=$(t.target)
re(d(Yt,[e.data("inv")]),e)}function xe(t,e){$(e[0]).on("click",d(e[1],t))}function Ie(t,e){$(t).on("click",`span.${e[0]}`,e[1])}function Re(t){!function(t){[["#fshReset",le],["#fshAll",Xt],["#fshNone",ie],["#fshDefault",oe]].forEach(d(xe,t))}(t),$("table.fshInvFilter").on("click",'input[type="checkbox"]',d(ce,t)),function(t){[["setName",d(he,t)],["takeItem",me],["recallItem",be],["wearItem",ye],["useItem",ve],["dropItem",_e],["sendItem",$e],["storeItem",ke]].forEach(d(Ie,t))}(t)}function Le(){let t
t=lt.player_id?`<b>&nbsp;Inventory Manager</b> ${lt.items.length} items (green = worn, blue = backpack)`:`<b>&nbsp;Guild Inventory Manager</b> ${lt.items.length} items (maroon = in BP, blue=guild store)`,k(Rt.replace("@@reportTitle@@",t),y)}function Me(){$("#fshMinLvl").val(Ot.fshMinLvl),$("#fshMaxLvl").val(Ot.fshMaxLvl)}let Ee
function je(t,e){return tt(Ee,Z(e[1]),Ot.fshMinLvl,Ot.fshMaxLvl)}function Se(){Ee=[t=>0===t].concat(et),$.fn.dataTable.ext.search.push(je)}function Te(){$.fn.dataTable.ext.search.push(((t,e,n,i)=>!Ot.checkedElements||Ot.checkedElements[i.type]))}function De(){$.fn.dataTable.ext.search.push(((t,e,n,i)=>!Ot.checkedElements||!Ot.checkedElements[-1]||function(t){return Ot.checkedElements[-1]&&t.stats&&-1!==t.stats.set_id}(i)))}function Ne(){$.fn.dataTable.ext.search.push(((t,e,n,i)=>{const s=(parseInt(i.rarity,10)+100).toString()
return!Ot.checkedElements||Ot.checkedElements[s]}))}function we(t,e){return t[e[1].id]=e[1],t}function Ae(){a.membrList=u(a.membrList).filter(K).reduce(we,{})}function qe(){z([xt,Se,Te,De,Ne,Le,Jt,Me])
const t=Qt()
!function(t){$("#fshMinLvl, #fshMaxLvl").on("keyup",d(te,t)),$(t).on("change","select.fshMoveItem",ge),Re(t)}(t),$("#fshRefresh").on("click",Ce),function(t){const e=$(`#${t.id}_filter input`)
e.prop("type","text")
const n=$("<span>&times;</span>")
e.wrap($('<span class="text-input-wrapper"/>')),e.after(n),n.on("click",d($t,t,e))}(t)}function Ge(){R("inventory.getInvMan"),qe(),L("inventory.getInvMan")}function Pe(){I(3,Ge)}function Ce(){_()||(k(`<span id="fshInvMan"><img src = "${x}">&nbsp;Getting inventory data...</span>`,y),function(){const t=[X(),_t()]
"guildinvmgr"===a.subcmd&&t.push(J(!1).then(Ae)),t.push(B(`fsh_${a.subcmd}`).then(Ft)),M(t,Pe)}())}export default Ce
//# sourceMappingURL=inventory-11f78853.js.map
